{"ast":null,"code":"import{useEffect,useState}from\"react\";import axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const History=()=>{const[history,setHistory]=useState([]);useEffect(()=>{fetchData();},[]);const fetchData=async()=>{const res=await axios.get(\"http://localhost:8002/my-bookings\",{headers:{Authorization:`Bearer ${localStorage.getItem(\"token\")}`}});// Tambahkan field dummy \"paid\": false (nanti akan di-replace dgn status)\nconst bookings=res.data.map(b=>({...b,amount:b.quantity*100000,paid:false}));// Cek status pembayaran per booking\nfor(let booking of bookings){try{const res=await axios.get(`http://localhost:8003/status/${booking.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem(\"token\")}`}});booking.paid=res.data.status===\"PAID\";}catch{booking.paid=false;}}setHistory(bookings);};const handlePay=async(bookingId,amount)=>{try{await axios.post(\"http://localhost:8003/pay\",{booking_id:bookingId,amount},{headers:{Authorization:`Bearer ${localStorage.getItem(\"token\")}`}});alert(\"Pembayaran berhasil!\");fetchData();// Refresh status\n}catch{alert(\"Gagal membayar\");}};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:40},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Riwayat Pemesanan\"}),history.map(b=>/*#__PURE__*/_jsxs(\"div\",{style:{border:\"1px solid #ccc\",padding:10,marginBottom:10},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Konser:\"}),\" \",b.concert]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Jumlah:\"}),\" \",b.quantity]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total:\"}),\" Rp \",b.amount.toLocaleString()]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",b.paid?\"Sudah Dibayar\":\"Belum Dibayar\"]}),!b.paid&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePay(b.id,b.amount),children:\"Bayar Sekarang\"})]},b.id))]});};export default History;","map":{"version":3,"names":["useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","History","history","setHistory","fetchData","res","get","headers","Authorization","localStorage","getItem","bookings","data","map","b","amount","quantity","paid","booking","id","status","handlePay","bookingId","post","booking_id","alert","style","padding","children","border","marginBottom","concert","toLocaleString","onClick"],"sources":["/Users/candrawjy/Documents/Project/Golang/concert-ticket/frontend/concert-ticket-app/src/pages/History.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport axios from \"axios\";\n\nconst History = () => {\n  const [history, setHistory] = useState<any[]>([]);\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    const res = await axios.get(\"http://localhost:8002/my-bookings\", {\n      headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` },\n    });\n\n    // Tambahkan field dummy \"paid\": false (nanti akan di-replace dgn status)\n    const bookings = res.data.map((b: any) => ({\n      ...b,\n      amount: b.quantity * 100000,\n      paid: false,\n    }));\n\n    // Cek status pembayaran per booking\n    for (let booking of bookings) {\n      try {\n        const res = await axios.get(`http://localhost:8003/status/${booking.id}`, {\n          headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` },\n        });\n        booking.paid = res.data.status === \"PAID\";\n      } catch {\n        booking.paid = false;\n      }\n    }\n\n    setHistory(bookings);\n  };\n\n  const handlePay = async (bookingId: number, amount: number) => {\n    try {\n      await axios.post(\n        \"http://localhost:8003/pay\",\n        { booking_id: bookingId, amount },\n        {\n          headers: { Authorization: `Bearer ${localStorage.getItem(\"token\")}` },\n        }\n      );\n      alert(\"Pembayaran berhasil!\");\n      fetchData(); // Refresh status\n    } catch {\n      alert(\"Gagal membayar\");\n    }\n  };\n\n  return (\n    <div style={{ padding: 40 }}>\n      <h2>Riwayat Pemesanan</h2>\n      {history.map((b) => (\n        <div key={b.id} style={{ border: \"1px solid #ccc\", padding: 10, marginBottom: 10 }}>\n          <div><strong>Konser:</strong> {b.concert}</div>\n          <div><strong>Jumlah:</strong> {b.quantity}</div>\n          <div><strong>Total:</strong> Rp {b.amount.toLocaleString()}</div>\n          <div><strong>Status:</strong> {b.paid ? \"Sudah Dibayar\" : \"Belum Dibayar\"}</div>\n          {!b.paid && (\n            <button onClick={() => handlePay(b.id, b.amount)}>Bayar Sekarang</button>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default History;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}